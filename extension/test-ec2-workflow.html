<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>EC2 Instance Launch - Test Workflow</title>
    <style>
        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
            margin: 0;
            padding: 20px;
            background-color: #f5f5f5;
        }
        
        .container {
            max-width: 1200px;
            margin: 0 auto;
            background: white;
            border-radius: 8px;
            padding: 20px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
        }
        
        .header {
            text-align: center;
            margin-bottom: 30px;
            padding-bottom: 20px;
            border-bottom: 2px solid #ff4444;
        }
        
        .header h1 {
            color: #ff4444;
            margin: 0;
        }
        
        .header p {
            color: #666;
            margin: 10px 0 0 0;
        }
        
        .test-section {
            margin-top: 30px;
            padding: 20px;
            background: #f8f9fa;
            border-radius: 8px;
        }
        
        .test-buttons {
            display: flex;
            gap: 10px;
            margin-bottom: 20px;
            flex-wrap: wrap;
        }
        
        .test-btn {
            padding: 10px 20px;
            background: #ff4444;
            color: white;
            border: none;
            border-radius: 5px;
            cursor: pointer;
            font-size: 14px;
            transition: background 0.3s ease;
        }
        
        .test-btn:hover {
            background: #e03e3e;
        }
        
        .test-btn.secondary {
            background: #6c757d;
        }
        
        .test-btn.secondary:hover {
            background: #5a6268;
        }
        
        .instructions {
            background: #e3f2fd;
            border-left: 4px solid #2196f3;
            padding: 15px;
            margin: 20px 0;
            border-radius: 0 5px 5px 0;
        }
        
        .instructions h4 {
            margin: 0 0 10px 0;
            color: #1976d2;
        }
        
        .instructions p {
            margin: 0;
            color: #333;
        }
        
        /* Simulate AWS Console styling */
        .aws-header {
            background: #232f3e;
            color: white;
            padding: 15px 20px;
            margin: -20px -20px 20px -20px;
            border-radius: 8px 8px 0 0;
        }
        
        .aws-header h2 {
            margin: 0;
            font-size: 18px;
        }
        
        .aws-content {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 20px;
        }
        
        .aws-section {
            background: white;
            border: 1px solid #ddd;
            border-radius: 5px;
            padding: 15px;
        }
        
        .aws-section h4 {
            margin: 0 0 15px 0;
            color: #333;
            font-size: 16px;
        }
        
        .aws-button {
            background: #ff9900;
            color: white;
            border: none;
            padding: 8px 16px;
            border-radius: 3px;
            cursor: pointer;
            font-size: 14px;
            margin: 5px;
        }
        
        .aws-button:hover {
            background: #e68900;
        }
        
        .aws-input {
            width: 100%;
            padding: 8px;
            border: 1px solid #ddd;
            border-radius: 3px;
            margin: 5px 0;
            font-size: 14px;
        }
        
        .aws-select {
            width: 100%;
            padding: 8px;
            border: 1px solid #ddd;
            border-radius: 3px;
            margin: 5px 0;
            font-size: 14px;
        }
        
        .aws-checkbox {
            margin: 5px 0;
        }
        
        .workflow-steps {
            background: #f8f9fa;
            border-radius: 8px;
            padding: 20px;
            margin-top: 20px;
        }
        
        .workflow-steps h3 {
            margin: 0 0 15px 0;
            color: #333;
        }
        
        .step-item {
            background: white;
            border: 1px solid #ddd;
            border-radius: 5px;
            padding: 10px;
            margin: 10px 0;
            cursor: pointer;
            transition: border-color 0.3s ease;
        }
        
        .step-item:hover {
            border-color: #ff4444;
        }
        
        .step-item.active {
            border-color: #ff4444;
            background: #fff5f5;
        }
        
        .step-number {
            display: inline-block;
            background: #ff4444;
            color: white;
            width: 24px;
            height: 24px;
            border-radius: 50%;
            text-align: center;
            line-height: 24px;
            font-size: 12px;
            font-weight: bold;
            margin-right: 10px;
        }
        
        .step-title {
            font-weight: 600;
            color: #333;
        }
        
        .step-description {
            font-size: 12px;
            color: #666;
            margin-top: 5px;
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <h1>EC2 Instance Launch Workflow</h1>
            <p>Test the complete 12-step EC2 instance launch process</p>
        </div>
        
        <div class="instructions">
            <h4>ðŸ§ª Testing Instructions</h4>
            <p>This page simulates the complete EC2 instance launch workflow. Click "Start Workflow" to begin the guided process, or click individual steps to test specific elements.</p>
        </div>
        
        <div class="test-section">
            <h3>Test EC2 Instance Launch Workflow</h3>
            <div class="test-buttons">
                <button class="test-btn" onclick="startWorkflow()">Start Workflow</button>
                <button class="test-btn" onclick="testStep(1)">Test Step 1 (Navigation)</button>
                <button class="test-btn" onclick="testStep(2)">Test Step 2</button>
                <button class="test-btn" onclick="testStep(3)">Test Step 3</button>
                <button class="test-btn" onclick="simulatePageNavigation('ec2')">Simulate EC2 Navigation</button>
                <button class="test-btn secondary" onclick="clearIndicators()">Clear All</button>
            </div>
            
            <div class="aws-header">
                <h2>AWS Management Console - EC2</h2>
            </div>
            
            <div class="aws-content">
                <div class="aws-section">
                    <h4>Services</h4>
                    <div class="service-card" data-testid="ec2">
                        <h3>EC2</h3>
                        <p>Elastic Compute Cloud</p>
                    </div>
                    
                    <h4>Launch Instance</h4>
                    <button class="aws-button" data-testid="launch-instance">Launch Instance</button>
                    <a data-analytics="launch-an-instance-button" class="awsui_button_vjswe_gmc8h_157 awsui_variant-primary_vjswe_gmc8h_231 awsui_link_vjswe_gmc8h_610" href="#" style="display: inline-block; padding: 8px 16px; background: #ff9900; color: white; border-radius: 3px; cursor: pointer; margin: 5px; text-decoration: none;">
                        <span class="awsui_content_vjswe_gmc8h_153 awsui_label_1f1d4_ocied_5">Launch instance</span>
                    </a>
                    
                    <h4>Instance Configuration</h4>
                    <input type="text" class="aws-input" data-testid="instance-name" placeholder="Instance Name">
                    
                    <h4>AMI Selection</h4>
                    <button class="aws-button" data-testid="ami-quick-start">Quick Start</button>
                    <div class="ami-option" data-testid="free-tier-ami">
                        <input type="radio" name="ami" id="amazon-linux">
                        <label for="amazon-linux">Amazon Linux 2 AMI (Free Tier Eligible)</label>
                    </div>
                </div>
                
                <div class="aws-section">
                    <h4>Instance Type</h4>
                    <select class="aws-select" data-testid="instance-type">
                        <option>t2.micro (Free Tier Eligible)</option>
                        <option>t2.small</option>
                        <option>t2.medium</option>
                    </select>
                    
                    <h4>Key Pair</h4>
                    <select class="aws-select" data-testid="key-pair">
                        <option>Create new key pair</option>
                        <option>Use existing key pair</option>
                    </select>
                    
                    <h4>Network Settings</h4>
                    <div class="aws-checkbox" data-testid="network-settings">
                        <input type="checkbox" id="default-vpc" checked>
                        <label for="default-vpc">Use default VPC</label>
                    </div>
                    
                    <h4>Storage Configuration</h4>
                    <div class="aws-checkbox" data-testid="storage-config">
                        <input type="checkbox" id="default-storage" checked>
                        <label for="default-storage">Use default storage (8 GB)</label>
                    </div>
                    
                    <h4>Launch Instance</h4>
                    <button class="aws-button" data-testid="launch-instance-button">Launch Instance</button>
                    
                    <h4>Instance Status</h4>
                    <div class="instance-status" data-testid="instance-id">
                        <p>Instance ID: i-1234567890abcdef0</p>
                        <p>Status: Running</p>
                    </div>
                    
                    <div class="aws-checkbox" data-testid="instance-checkbox">
                        <input type="checkbox" id="select-instance">
                        <label for="select-instance">Select Instance</label>
                    </div>
                </div>
            </div>
        </div>
        
        <div class="workflow-steps">
            <h3>Complete Workflow Steps</h3>
            <div id="workflow-steps-list">
                <!-- Steps will be populated by JavaScript -->
            </div>
        </div>
    </div>

    <script>
        // Workflow steps data
        const workflowSteps = [
            {
                id: 1,
                title: 'Navigate to EC2 Console',
                description: 'Open the Amazon EC2 console at <a href="https://console.aws.amazon.com/ec2/" target="_blank" style="color: #ff4444; text-decoration: underline;">https://console.aws.amazon.com/ec2/</a>',
                selector: '[data-testid="ec2"]'
            },
            {
                id: 2,
                title: 'Launch Instance',
                description: 'From the EC2 console dashboard, in the Launch instance pane, choose Launch instance',
                selector: 'a[data-analytics="launch-an-instance-button"]'
            },
            {
                id: 3,
                title: 'Enter Instance Name',
                description: 'Under Name and tags, for Name, enter a descriptive name for your instance',
                selector: '[data-testid="instance-name"]'
            },
            {
                id: 4,
                title: 'Choose Operating System',
                description: 'Under Application and OS Images, choose Quick Start, and then choose the operating system (OS) for your instance. For your first Linux instance, we recommend Amazon Linux',
                selector: '[data-testid="ami-quick-start"]'
            },
            {
                id: 5,
                title: 'Select Free Tier AMI',
                description: 'From Amazon Machine Image (AMI), select an AMI that is marked Free Tier eligible',
                selector: '[data-testid="free-tier-ami"]'
            },
            {
                id: 6,
                title: 'Choose Instance Type',
                description: 'Under Instance type, for Instance type, select an instance type that is marked Free Tier eligible',
                selector: '[data-testid="instance-type"]'
            },
            {
                id: 7,
                title: 'Create Key Pair',
                description: 'Under Key pair (login), for Key pair name, choose an existing key pair or choose Create new key pair to create your first key pair',
                selector: '[data-testid="key-pair"]'
            },
            {
                id: 8,
                title: 'Configure Network Settings',
                description: 'Under Network settings, notice that we selected your default VPC and configured a security group. For your first instance, we recommend that you use the default settings',
                selector: '[data-testid="network-settings"]'
            },
            {
                id: 9,
                title: 'Configure Storage',
                description: 'Under Configure storage, notice that we configured a root volume but no data volumes. This is sufficient for test purposes',
                selector: '[data-testid="storage-config"]'
            },
            {
                id: 10,
                title: 'Review and Launch',
                description: 'Review a summary of your instance configuration in the Summary panel, and when you\'re ready, choose Launch instance',
                selector: '[data-testid="launch-instance-button"]'
            },
            {
                id: 11,
                title: 'Monitor Instance Status',
                description: 'If the launch is successful, choose the ID of the instance from the Success notification to open the Instances page and monitor the status of the launch',
                selector: '[data-testid="instance-id"]'
            },
            {
                id: 12,
                title: 'Check Instance State',
                description: 'Select the checkbox for the instance. The initial instance state is pending. After the instance starts, its state changes to running. Choose the Status and alarms tab',
                selector: '[data-testid="instance-checkbox"]'
            }
        ];
        
        let currentStep = 0;
        
        // Initialize workflow steps display
        function initializeWorkflowSteps() {
            const stepsList = document.getElementById('workflow-steps-list');
            stepsList.innerHTML = '';
            
            workflowSteps.forEach(step => {
                const stepDiv = document.createElement('div');
                stepDiv.className = 'step-item';
                stepDiv.onclick = () => testStep(step.id);
                stepDiv.innerHTML = `
                    <span class="step-number">${step.id}</span>
                    <span class="step-title">${step.title}</span>
                    <div class="step-description">${step.description}</div>
                `;
                stepsList.appendChild(stepDiv);
            });
        }
        
        // Simulate the extension's visual cue functionality
        function createVisualCue(selector, stepNumber, totalSteps) {
            // Clear existing cues
            clearIndicators();
            
            const element = document.querySelector(selector);
            if (!element) {
                alert(`Element with selector "${selector}" not found!`);
                return;
            }
            
            const rect = element.getBoundingClientRect();
            
            // Create overlay
            const overlay = document.createElement('div');
            overlay.id = 'test-overlay';
            overlay.style.cssText = `
                position: fixed;
                top: 0;
                left: 0;
                width: 100%;
                height: 100%;
                pointer-events: none;
                z-index: 999999;
                font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
            `;
            document.body.appendChild(overlay);
            
            // Create visual cue
            const cue = document.createElement('div');
            cue.id = 'test-cue';
            cue.style.cssText = `
                position: absolute;
                left: ${rect.left - 20}px;
                top: ${rect.top - 20}px;
                width: ${rect.width + 40}px;
                height: ${rect.height + 40}px;
                border: 3px solid #ff4444;
                border-radius: 8px;
                background: rgba(255, 68, 68, 0.1);
                pointer-events: none;
                animation: pulse 2s infinite;
                z-index: 1000000;
            `;
            
            // Add pulse animation
            if (!document.getElementById('test-styles')) {
                const style = document.createElement('style');
                style.id = 'test-styles';
                style.textContent = `
                    @keyframes pulse {
                        0% { box-shadow: 0 0 0 0 rgba(255, 68, 68, 0.7); }
                        70% { box-shadow: 0 0 0 10px rgba(255, 68, 68, 0); }
                        100% { box-shadow: 0 0 0 0 rgba(255, 68, 68, 0); }
                    }
                `;
                document.head.appendChild(style);
            }
            
            overlay.appendChild(cue);
            
            // Create guidance panel
            createGuidancePanel(element, rect, stepNumber, totalSteps);
        }
        
        function createGuidancePanel(element, rect, stepNumber, totalSteps) {
            const panel = document.createElement('div');
            panel.id = 'test-panel';
            panel.style.cssText = `
                position: absolute;
                background: white;
                border: 2px solid #ff4444;
                border-radius: 8px;
                padding: 16px;
                box-shadow: 0 4px 20px rgba(0, 0, 0, 0.15);
                max-width: 300px;
                z-index: 1000001;
                font-size: 14px;
                line-height: 1.4;
            `;
            
            // Position panel near target element
            const panelLeft = Math.min(rect.right + 20, window.innerWidth - 320);
            const panelTop = Math.max(rect.top - 10, 10);
            
            panel.style.left = `${panelLeft}px`;
            panel.style.top = `${panelTop}px`;
            
            // Panel content
            panel.innerHTML = `
                <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 8px;">
                    <span style="font-weight: 600; color: #ff4444;">Step ${stepNumber} of ${totalSteps}</span>
                    <button onclick="clearIndicators()" style="background: none; border: none; font-size: 18px; cursor: pointer; color: #666;">Ã—</button>
                </div>
                <h3 style="margin: 0 0 8px 0; font-size: 16px; color: #333;">${getStepTitle(element)}</h3>
                <p style="margin: 0 0 12px 0; color: #666;">${getStepDescription(element)}</p>
                <div style="display: flex; gap: 8px;">
                    <button onclick="previousStep()" style="padding: 6px 12px; background: #f0f0f0; border: 1px solid #ddd; border-radius: 4px; cursor: pointer; font-size: 12px;">Previous</button>
                    <button onclick="nextStep()" style="padding: 6px 12px; background: #ff4444; color: white; border: none; border-radius: 4px; cursor: pointer; font-size: 12px;">Next</button>
                    <button onclick="clearIndicators()" style="padding: 6px 12px; background: #666; color: white; border: none; border-radius: 4px; cursor: pointer; font-size: 12px;">Stop</button>
                </div>
            `;
            
            document.getElementById('test-overlay').appendChild(panel);
            
            // Handle clickable links in the description
            const links = panel.querySelectorAll('a');
            links.forEach(link => {
                link.addEventListener('click', (e) => {
                    e.preventDefault();
                    e.stopPropagation();
                    
                    const url = link.href;
                    console.log('Navigation link clicked:', url);
                    
                    // Simulate navigation for testing
                    simulatePageNavigation('ec2');
                });
            });
        }
        
        function getStepTitle(element) {
            const testId = element.getAttribute('data-testid');
            const step = workflowSteps.find(s => s.selector === `[data-testid="${testId}"]`);
            return step ? step.title : 'Complete Action';
        }
        
        function getStepDescription(element) {
            const testId = element.getAttribute('data-testid');
            const step = workflowSteps.find(s => s.selector === `[data-testid="${testId}"]`);
            return step ? step.description : 'Follow the highlighted element';
        }
        
        function clearIndicators() {
            const overlay = document.getElementById('test-overlay');
            if (overlay) {
                overlay.remove();
            }
            
            // Clear active step highlighting
            document.querySelectorAll('.step-item').forEach(item => {
                item.classList.remove('active');
            });
        }
        
        // Test functions
        function startWorkflow() {
            currentStep = 0;
            nextStep();
        }
        
        function testStep(stepNumber) {
            const step = workflowSteps[stepNumber - 1];
            if (step) {
                createVisualCue(step.selector, stepNumber, workflowSteps.length);
                
                // Highlight the step in the list
                document.querySelectorAll('.step-item').forEach(item => {
                    item.classList.remove('active');
                });
                document.querySelectorAll('.step-item')[stepNumber - 1].classList.add('active');
            }
        }
        
        function nextStep() {
            if (currentStep < workflowSteps.length) {
                currentStep++;
                testStep(currentStep);
            } else {
                alert('Workflow completed!');
                clearIndicators();
            }
        }
        
        function previousStep() {
            if (currentStep > 1) {
                currentStep--;
                testStep(currentStep);
            }
        }
        
        // Simulate page navigation for testing
        function simulatePageNavigation(targetPage) {
            // Simulate URL change
            const originalUrl = window.location.href;
            const newUrl = targetPage === 'ec2' ? 'https://ec2.console.aws.amazon.com/' : originalUrl;
            
            // Update the URL in the browser (for testing purposes)
            window.history.pushState({}, '', newUrl);
            
            // Trigger page change detection
            setTimeout(() => {
                checkPageProgress();
            }, 500);
        }
        
        // Check page progress (simulated)
        function checkPageProgress() {
            const currentUrl = window.location.href;
            console.log('Checking page progress for URL:', currentUrl);
            
            // If we're on EC2 page and on step 1, advance to step 2
            if (currentUrl.includes('ec2.console.aws.amazon.com') && currentStep === 1) {
                console.log('Page progress detected, advancing to next step');
                nextStep();
            }
        }
        
        // Initialize the page
        initializeWorkflowSteps();
    </script>
</body>
</html>
